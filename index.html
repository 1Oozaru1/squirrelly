<!DOCTYPE html>
<html>

<head>
    <script src="squirrelly.js"></script>
</head>

<body>
    <div id="result1"></div>
    <p>--------------------</p>
    <div id="functionResult"></div>

<textarea oninput="comp()" id="input" style="width: 200px; height: 200px;">
Hi
{{if(4===3)}}
AAAAAHHH!
{{#else}}
Math works
{{/if}} Nooooo
{{ben()}}
Hi
{{#pineapple}}
This is a pineapple
{{#gubler}}
Gublers
{{/ben}}
Hey h
</textarea>
    <div id="output"></div>
    <script>
        Sqrl.defineFilter("reverse", function (str) {
            var out = ''
            for (var i = str.length - 1; i >= 0; i--) {
                out += str.charAt(i)
            }
            return out || str
        })

        Sqrl.defineHelper("ben", function(args, content, blocks, options) {
            return "The content of gubler: " + blocks.gubler() + ", the content of pineapple: " + blocks.pineapple()
        })

        Sqrl.defaultFilters.reverse = true
        Sqrl.autoEscape(true)


        function comp() {
            console.clear()
            console.time("comp")
            let newtemplatefunction = Sqrl.Precompile(document.getElementById("input").value)

            console.log("Function returned by comp: ")
            console.log(newtemplatefunction.toString())
            console.log("typeof newtemplatefunction: " + typeof newtemplatefunction)
            let result = newtemplatefunction({
                htmlstuff: "<script>alert('hey')<\/script><p>alert('hey')</p><p>alert('hey')</p><p>alert('hey')</p>",
                arr: ["Hey", "<p>Malicious XSS</p>", "Hey", 3, 3*4],
                obj: {
                    firstchild: "HI",
                    secondchild: "HEY"
                }
            }, Sqrl)
            document.getElementById("result1").innerHTML = result
            console.timeEnd("comp")
            document.getElementById("functionResult").innerHTML = newtemplatefunction

        }
        comp()
    </script>
    <p>Helper is called with (args, content, blocks, options)</p>
    <pre>Native helper: 		if: {
        helperStart: function (varName, id) {
            return "if("
        },
        afterParams: function (varName, id) {
            return ") {"
        },
        contentStart: function (varName, id) {
            return varName + "+=("
        },
        helperEnd: function (varName, id) {
            return ")()}"
        },
        namespace: {},
        blocks: {
            else: function (varName, id) {
                return ")()} else {" + varName + "+=("
            }
        }
    },</pre>
</body>

</html>