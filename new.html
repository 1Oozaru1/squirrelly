<!DOCTYPE html>
<html>

<head>
    <script src="./dist/squirrelly.js"></script>
</head>

<body>
    <div id="result1"></div>
    <p>--------------------</p>
    <div id="functionResult"></div>

<textarea oninput="comp()" id="input" style="width: 200px; height: 200px;">
First text
{{If(4===3)}}
Math is broken!
{{#else}}
Phew, we're okay!
{{/If}}
</textarea>
    <div id="output"></div>
    <script>
        Sqrl.registerFilter("reverse", function (str) {
            var out = ''
            for (var i = str.length - 1; i >= 0; i--) {
                out += str.charAt(i)
            }
            return out || str
        })

        Sqrl.Utils.defaultFilters.reverse = true
        Sqrl.Utils.autoEscape(true)


        function comp() {
            console.clear()
            console.time("comp")
            let newtemplatefunction = Sqrl.Precompile(document.getElementById("input").value)

            console.log("Function returned by comp: ")
            console.log(newtemplatefunction.toString())
            let result = newtemplatefunction({
                htmlstuff: "<script>alert('hey')<\/script><p>alert('hey')</p><p>alert('hey')</p><p>alert('hey')</p>",
                arr: ["Hey", "<p>Malicious XSS</p>", "Hey", 3, 3*4]
            }, Sqrl)
            document.getElementById("result1").innerHTML = result
            console.timeEnd("comp")
            document.getElementById("functionResult").innerHTML = newtemplatefunction

        }
        comp()
    </script>
    <p>Helper is called with (args, content, blocks, options)</p>
</body>

</html>